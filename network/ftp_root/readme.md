## 简述eBPF在Android逆向中的使用

目标: FakeLocation  
问题: ptrace反调试，具有root权限，大量IPC通信，混淆严重，难以分析  
想法: 使用ebpf，从内核入手监控文件操作、系统命令调用、网络操作等  

eBPF（Extended Berkeley Packet Filter）是一种可以在 Linux 内核中运行用户编写的程序，在指定事件发生时进行执行，而不需要修改内核代码或加载内核模块的技术。  
内核中存在eBPF虚拟机，JIT运行eBPF字节码，并且在指定的事件发生时执行。  
考虑到安全性，eBPF虚拟机并非图灵完备，如不允许循环(新内核支持有界循环)，所有内存访问必须有界，每个程序有最大指令长度限制(默认4096，新内核已放宽到100万条)。在eBPF字节码被加载到内核的时候会进行检查以保证以上要求的到满足。

内核空间和用户空间如何交互？
内核提供了api，允许eBPF程序将数据写入环形缓冲区和键值map，编写用户空间程序从环形缓冲区和键值map中读取数据。


